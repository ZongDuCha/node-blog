<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" type="text/css" href="/public/web/css/index.css">
</head>
<body>
<header>
    <img src="/public/web/logo-bj.jpg" alt="" class="logo-bj">

    <nav>
        <li><a href="/">Home</a></li>
        <li><a href="">Github</a></li>
        <li><a href="">Juejin</a></li>
        <li><a href="">About</a></li>
        <li><a href="/admin">Admin</a></li>
    </nav>

    <img src={{logoURL}} alt="" class="logo">
    <div class="tx">
        <h1>{{username || '还没登录'}}</h1>
        <p>梦想还是要有的，万一实现了呢</p>
    </div>
</header>

<div class="container newInfo">
    <div class="fLeft">
        <div class="new-head">
            <h1>{{title}}</h1>
        </div>
    
        <!-- 用js对html标签转义一下 -->
        <div class="new-cont" data-cont="{{cont}}">
        </div>

        <!-- 文章评论 -->
        <div class="new-comment">
            <textarea name="" class="comm" placeholder="填写评论内容" cols="30" rows="10"></textarea>
            <button class='sub'>确认回答</button>
            <div class="comm-top">
            </div>

            <div class="comm-list">
            </div>
        </div>
    </div>

    <!-- fRight -->
    <div class="fRight">
        <div class="small">
            <img src="/public/web/logonameimg.png" alt="">
            <div class="name">{{name || '没有名字'}}</div>
            <div class="time">发布时间:{{time}}</div>
            {% for tab in tab %}
                <span>{{tab}}</span>
            {% endfor %}
    </div>
</div>

<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script>
var cont = getEl('[data-cont]'),
    sub = getEl('.sub'),
    comm = getEl('.comm'),
    commTop = getEl('.comm-top'),
    id = location.search.split('id=')[1],
    list = getEl('.comm-list');
cont.innerHTML = cont.dataset.cont;

sub.onclick = function(){
    var value = comm.value;
    if(value == '' || value == null || !value.trim()){
        alert('不能为空');
        return;
    }
    axios.post('../api/news/comm',{
        cont: value,
        newsId: id
    }).then(function(res){
        if(res.data){
            comm.value = '';
            getComm()
        }else{
            alert('还没登录')
        }
    })
}

function getComm(){
    axios.post('../api/news/getComm',{
    id: id
    }).then(function(res){
        if(res.data){
            var str = '',data = res.data;
            commTop.innerHTML = '全部评论('+data.length+')';
            for(var i=0;i<data.length;i++){
                str += `<div class="list">
                    <img src="${data[i].logoURL}" alt="">
                    <div class="name-top">
                        <span>${data[i].comName}</span>
                        <span>${data[i].contTime}</span>
                    </div>
                    <div class="tx">
                        ${data[i].comCont}
                    </div>
                </div>`
            }
            list.innerHTML = str;
        }
    })
}
getComm()
function getEl(e,p){
    return (p || document).querySelector(e)
}
</script>
</body>
</html>